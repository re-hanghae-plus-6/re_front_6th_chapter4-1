# ì‹¬í™”ê³¼ì œ: React SSR & SSG

## ğŸ¯ ê³¼ì œ ê°œìš”
React í”„ë¡œì íŠ¸ì—ì„œ **Server Side Rendering(SSR)**ê³¼ **Static Site Generation(SSG)**ì„ êµ¬í˜„í•˜ì—¬, Reactì˜ ì»´í¬ë„ŒíŠ¸ ê¸°ë°˜ ì•„í‚¤í…ì²˜ì—ì„œë„ ì´ˆê¸° ë¡œë”© ì„±ëŠ¥ ìµœì í™”ì™€ SEO í–¥ìƒì„ ë‹¬ì„±í•©ë‹ˆë‹¤.

## ğŸ“‹ êµ¬í˜„í•´ì•¼ í•  ê¸°ëŠ¥

### 1. React SSR (Server Side Rendering)
- React `renderToString`ì„ í™œìš©í•œ ì„œë²„ ë Œë”ë§
- React Router ì„œë²„ í™˜ê²½ ì§€ì›
- React ìƒíƒœê´€ë¦¬ ì„œë²„ ì´ˆê¸°í™”
- ì„œë²„/í´ë¼ì´ì–¸íŠ¸ í•˜ì´ë“œë ˆì´ì…˜ ì²˜ë¦¬

### 2. React SSG (Static Site Generation)
- React ì»´í¬ë„ŒíŠ¸ë¥¼ ì •ì  HTMLë¡œ ë¹Œë“œ íƒ€ì„ ìƒì„±
- TypeScript ì§€ì› ë° ë¹Œë“œ íŒŒì´í”„ë¼ì¸ êµ¬ì„±
- React Suspense ë° ë¹„ë™ê¸° ì»´í¬ë„ŒíŠ¸ ì²˜ë¦¬

### 3. ìœ ë‹ˆë²„ì„¤ React ì½”ë“œ
- ì„œë²„/í´ë¼ì´ì–¸íŠ¸ ë™ì¼ ì½”ë“œ ì‹¤í–‰
- ë¸Œë¼ìš°ì € API ì•ˆì „ ì²˜ë¦¬
- React Hook ì„œë²„ ì•ˆì „ì„± ë³´ì¥

## ğŸ“ êµ¬í˜„í•´ì•¼ í•  íŒŒì¼ êµ¬ì¡°

```
packages/react/
â”œâ”€â”€ server.js                    # Express React SSR ì„œë²„  
â”œâ”€â”€ static-site-generate.js      # React SSG ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main-server.tsx         # React SSR ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ ssr-data.ts         # ì„œë²„ ë°ì´í„° ë¡œë”© ë¡œì§
â”‚   â”‚   â””â”€â”€ hydration.ts        # í´ë¼ì´ì–¸íŠ¸ í•˜ì´ë“œë ˆì´ì…˜
â”‚   â”œâ”€â”€ router/
â”‚   â”‚   â””â”€â”€ router.ts           # ìœ ë‹ˆë²„ì„¤ React Router
â”‚   â””â”€â”€ App.tsx                 # ë©”ì¸ React ì»´í¬ë„ŒíŠ¸
â”œâ”€â”€ vite.config.ts              # SSR ë¹Œë“œ ì„¤ì •
â””â”€â”€ package.json                # TypeScript & React ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸
```

## ğŸ”§ 1ë‹¨ê³„: React SSR ì„œë²„ êµ¬ì¶•

### `server.js` êµ¬í˜„
```javascript
import fs from "node:fs/promises";
import express from "express";

// Constants
const prod = process.env.NODE_ENV === "production";
const port = process.env.PORT || 5174; // Reactìš© í¬íŠ¸ (vanillaê³¼ êµ¬ë¶„)
const base = process.env.BASE || (prod ? "/front_6th_chapter4-1/react/" : "/");

// Cached production assets
const templateHtml = prod ? await fs.readFile("../../dist/react/index.html", "utf-8") : "";
const app = express();

// Add Vite or respective production middlewares
let vite;
if (!prod) {
  // TODO: Vite ê°œë°œ ì„œë²„ ì„¤ì •
  // íŒíŠ¸: createServerë¡œ ë¯¸ë“¤ì›¨ì–´ ëª¨ë“œ ì„¤ì •, React í™˜ê²½ì— ìµœì í™”
} else {
  // TODO: í”„ë¡œë•ì…˜ í™˜ê²½ ì„¤ì •  
  // íŒíŠ¸: compression, sirvë¡œ React ë¹Œë“œ íŒŒì¼ ì„œë¹™
}

// Root redirect for convenience
if (prod && base !== "/") {
  // TODO: ë£¨íŠ¸ ê²½ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì²˜ë¦¬
}

// Serve HTML
app.use(async (req, res) => {
  try {
    const url = req.originalUrl;
    const query = req.query;

    let template;
    let render;
    if (!prod) {
      // TODO: ê°œë°œ í™˜ê²½ì—ì„œ React SSR ëª¨ë“ˆ ë¡œë“œ
      // íŒíŠ¸:
      // 1. index.html í…œí”Œë¦¿ ì½ê¸°
      // 2. vite.transformIndexHtml ì ìš©
      // 3. /src/main-server.tsx ëª¨ë“ˆ ë¡œë“œ
    } else {
      // TODO: í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ë¹Œë“œëœ React SSR ëª¨ë“ˆ ë¡œë“œ
      // íŒíŠ¸: ì»´íŒŒì¼ëœ .js íŒŒì¼ import
    }

    // TODO: React render í•¨ìˆ˜ í˜¸ì¶œ
    // íŒíŠ¸: urlê³¼ queryë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ì „ë‹¬

    // TODO: React í•˜ì´ë“œë ˆì´ì…˜ì„ ìœ„í•œ ì´ˆê¸° ë°ì´í„° ì£¼ì…
    // íŒíŠ¸: window.__INITIAL_DATA__ì— rendered.initialData í• ë‹¹

    // TODO: í…œí”Œë¦¿ì— React ë Œë”ë§ ê²°ê³¼ ì‚½ì…
    // íŒíŠ¸: <!--app-html-->ì— React ì»´í¬ë„ŒíŠ¸ HTML ì‚½ì…

    res.status(200).set({ "Content-Type": "text/html" }).send(html);
  } catch (e) {
    vite?.ssrFixStacktrace(e);
    console.log(e.stack);
    res.status(500).end(e.stack);
  }
});

// Start http server
app.listen(port, () => {
  console.log(`React Server started at http://localhost:${port}`);
});
```

**êµ¬í˜„ ì²´í¬í¬ì¸íŠ¸:**
- [ ] React ê°œë°œ/í”„ë¡œë•ì…˜ í™˜ê²½ë³„ ì„¤ì •
- [ ] TypeScript SSR ëª¨ë“ˆ ë¡œë“œ
- [ ] React ë Œë”ë§ ê²°ê³¼ í…œí”Œë¦¿ ì‚½ì…
- [ ] ì—ëŸ¬ ì²˜ë¦¬ ë° ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤

## ğŸ”§ 2ë‹¨ê³„: React SSR ë Œë”ë§ ë¡œì§

### `src/main-server.tsx` êµ¬í˜„
```typescript
import { renderToString } from "react-dom/server";
import { App } from "./App";
import { router } from "./router";
import { loadHomePageData, loadProductDetailData } from "./services/ssr-data";
import { PRODUCT_ACTIONS, productStore } from "./entities";
import { HomePage, ProductDetailPage } from "./pages";
import type { QueryPayload } from "@hanghae-plus/lib";

export const render = async (url: string, query: QueryPayload) => {
  try {
    // TODO: React Router ì„œë²„ ì´ˆê¸°í™”
    // íŒíŠ¸:
    // 1. router.push(url)ë¡œ í˜„ì¬ URL ì„¤ì •
    // 2. router.queryì— query í• ë‹¹

    // TODO: URL íŒ¨í„´ì— ë”°ë¥¸ ë°ì´í„° í”„ë¦¬ë¡œë”©
    let initialData: any = {};

    if (router.target === HomePage) {
      // TODO: í™ˆí˜ì´ì§€ ë°ì´í„° ë¡œë“œ
      // íŒíŠ¸:
      // 1. loadHomePageData(url) í˜¸ì¶œ
      // 2. ì„±ê³µì‹œ initialDataì— í• ë‹¹
      // 3. productStore.dispatchë¡œ SETUP ì•¡ì…˜ í˜¸ì¶œ
      // 4. products, categories, totalCount ì„¤ì •
      
    } else if (router.target === ProductDetailPage) {
      // TODO: ìƒí’ˆ ìƒì„¸ í˜ì´ì§€ ë°ì´í„° ë¡œë“œ
      // íŒíŠ¸:
      // 1. router.params.idë¡œ ìƒí’ˆ ID ì¶”ì¶œ
      // 2. loadProductDetailData(productId) í˜¸ì¶œ
      // 3. SET_CURRENT_PRODUCT ì•¡ì…˜ í˜¸ì¶œ
      // 4. relatedProductsê°€ ìˆìœ¼ë©´ SET_RELATED_PRODUCTS í˜¸ì¶œ
    }

    // TODO: React ì»´í¬ë„ŒíŠ¸ë¥¼ HTML ë¬¸ìì—´ë¡œ ë Œë”ë§
    // íŒíŠ¸: renderToString(<App />) ì‚¬ìš©

    return {
      html,
      head: `<title>React Shopping App</title>`,
      initialData,
    };
  } catch (error) {
    const err = error as Error;
    console.error("React SSR ë Œë”ë§ ì˜¤ë¥˜:", error);
    
    return {
      html: `<div>í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${err.message}</div>`,
      head: `<title>React Shopping App</title>`,
      initialData: {},
    };
  }
};
```

**êµ¬í˜„ ì²´í¬í¬ì¸íŠ¸:**
- [ ] React Router ì„œë²„ ì´ˆê¸°í™”
- [ ] í˜ì´ì§€ë³„ ë°ì´í„° í”„ë¦¬ë¡œë”©
- [ ] React ìƒíƒœê´€ë¦¬ ì„œë²„ ì„¤ì •
- [ ] renderToString React ì»´í¬ë„ŒíŠ¸ ë Œë”ë§

## ğŸ”§ 3ë‹¨ê³„: ì„œë²„ ë°ì´í„° ë¡œë”© ì„œë¹„ìŠ¤

### `src/services/ssr-data.ts` êµ¬í˜„
```typescript
import { Router } from "@hanghae-plus/lib";
import { mockGetProducts, mockGetCategories, mockGetProduct } from "../mocks/server.js";

export interface HomePageData {
  products: any[];
  categories: any[];
  totalCount: number;
}

export interface ProductDetailData {
  currentProduct: any;
  relatedProducts?: any[];
}

export async function loadHomePageData(url: string): Promise<HomePageData | null> {
  try {
    // TODO: URLì—ì„œ query íŒŒë¼ë¯¸í„° ì¶”ì¶œ
    // íŒíŠ¸: Router.parseQueryì™€ URL ê°ì²´ ì‚¬ìš©
    
    // TODO: ìƒí’ˆ ëª©ë¡ ë° ì¹´í…Œê³ ë¦¬ ë°ì´í„° ë¡œë“œ
    // íŒíŠ¸:
    // 1. mockGetProducts(query) í˜¸ì¶œ
    // 2. mockGetCategories() í˜¸ì¶œ  
    // 3. HomePageData ì¸í„°í˜ì´ìŠ¤ì— ë§ê²Œ ë°˜í™˜

    return {
      products: productsData.products,
      categories,
      totalCount: productsData.pagination.total,
    };
  } catch (error) {
    console.error("í™ˆí˜ì´ì§€ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", error);
    return null;
  }
}

export async function loadProductDetailData(productId: string): Promise<ProductDetailData | null> {
  try {
    // TODO: ìƒí’ˆ ìƒì„¸ ì •ë³´ ë¡œë“œ
    // íŒíŠ¸: mockGetProduct(productId) í˜¸ì¶œ
    
    // TODO: ê´€ë ¨ ìƒí’ˆ ë¡œë“œ
    let relatedProducts = [];
    if (product.category2) {
      try {
        // íŒíŠ¸:
        // 1. product.category2ë¡œ ê°™ì€ ì¹´í…Œê³ ë¦¬ ìƒí’ˆ ê²€ìƒ‰
        // 2. mockGetProducts í˜¸ì¶œ (category2, limit, page ë§¤ê°œë³€ìˆ˜)
        // 3. í˜„ì¬ ìƒí’ˆ ì œì™¸ í•„í„°ë§
      } catch (error) {
        console.error("ê´€ë ¨ ìƒí’ˆ ë¡œë“œ ì‹¤íŒ¨:", error);
      }
    }

    return {
      currentProduct: product,
      relatedProducts,
    };
  } catch (error) {
    console.error("ìƒí’ˆ ìƒì„¸ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", error);
    return null;
  }
}
```

**êµ¬í˜„ ì²´í¬í¬ì¸íŠ¸:**
- [ ] URL ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ì¶”ì¶œ
- [ ] Mock ë°ì´í„° API í˜¸ì¶œ
- [ ] TypeScript ì¸í„°í˜ì´ìŠ¤ ì¤€ìˆ˜
- [ ] ì—ëŸ¬ ì²˜ë¦¬ ë° null ë°˜í™˜

## ğŸ”§ 4ë‹¨ê³„: React í´ë¼ì´ì–¸íŠ¸ í•˜ì´ë“œë ˆì´ì…˜

### `src/services/hydration.ts` êµ¬í˜„
```typescript
import { productStore, PRODUCT_ACTIONS } from "../entities";

export function hydrateFromServerData() {
  // TODO: ì„œë²„ì—ì„œ ì „ë‹¬ëœ ì´ˆê¸° ë°ì´í„° í™•ì¸
  if (typeof window !== "undefined" && window.__INITIAL_DATA__) {
    const initialData = (window as any).__INITIAL_DATA__;
    
    try {
      if (initialData.products && initialData.categories) {
        // TODO: í™ˆí˜ì´ì§€ ë°ì´í„° ë³µì›
        // íŒíŠ¸:
        // 1. PRODUCT_ACTIONS.SETUP ì•¡ì…˜ í˜¸ì¶œ
        // 2. products, categories, totalCount ì„¤ì •
        // 3. loading: false, status: "done" ì„¤ì •
      }
      
      if (initialData.currentProduct) {
        // TODO: ìƒí’ˆ ìƒì„¸ ë°ì´í„° ë³µì›
        // íŒíŠ¸:
        // 1. SET_CURRENT_PRODUCT ì•¡ì…˜ í˜¸ì¶œ
        // 2. relatedProductsê°€ ìˆìœ¼ë©´ SET_RELATED_PRODUCTS ì•¡ì…˜ í˜¸ì¶œ
      }
      
      console.log("âœ… ì„œë²„ ë°ì´í„° í•˜ì´ë“œë ˆì´ì…˜ ì™„ë£Œ");
    } catch (error) {
      console.error("âŒ í•˜ì´ë“œë ˆì´ì…˜ ì˜¤ë¥˜:", error);
    }
    
    // TODO: ì´ˆê¸° ë°ì´í„° ì •ë¦¬
    // íŒíŠ¸: delete (window as any).__INITIAL_DATA__
  }
}
```

### `src/main.tsx` ìˆ˜ì • (í´ë¼ì´ì–¸íŠ¸ ì—”íŠ¸ë¦¬í¬ì¸íŠ¸)
```tsx
import { StrictMode } from "react";
import { createRoot } from "react-dom/client";
import { App } from "./App";
import { hydrateFromServerData } from "./services/hydration";

// TODO: ì„œë²„ ë°ì´í„° í•˜ì´ë“œë ˆì´ì…˜
// íŒíŠ¸: hydrateFromServerData() í•¨ìˆ˜ í˜¸ì¶œ

const container = document.getElementById("root");
if (!container) throw new Error("Root container not found");

// TODO: React 18 ë°©ì‹ìœ¼ë¡œ ë£¨íŠ¸ ìƒì„± ë° ë Œë”ë§
// íŒíŠ¸:
// 1. createRoot(container) ì‚¬ìš©
// 2. root.render()ë¡œ <App /> ë Œë”ë§
// 3. StrictModeë¡œ ê°ì‹¸ê¸°
```

**êµ¬í˜„ ì²´í¬í¬ì¸íŠ¸:**
- [ ] ì„œë²„ ë°ì´í„° ì¡´ì¬ í™•ì¸
- [ ] React ìƒíƒœê´€ë¦¬ì— ë°ì´í„° ë³µì›
- [ ] ë©”ëª¨ë¦¬ ì •ë¦¬
- [ ] React 18 í•˜ì´ë“œë ˆì´ì…˜

## ğŸ”§ 5ë‹¨ê³„: ìœ ë‹ˆë²„ì„¤ React ë¼ìš°í„°

### `src/router/router.ts` í™•ì¥
```typescript
import { Router, MemoryRouter } from "@hanghae-plus/lib";
import { HomePage, ProductDetailPage, NotFoundPage } from "../pages";

// TODO: ì„œë²„/í´ë¼ì´ì–¸íŠ¸ í™˜ê²½ì— ë”°ë¥¸ ë¼ìš°í„° ì„ íƒ
const createRouter = () => {
  if (typeof window === "undefined") {
    // TODO: ì„œë²„ í™˜ê²½ ë¼ìš°í„° ì„¤ì •
    // íŒíŠ¸: MemoryRouter ì‚¬ìš©
  } else {
    // TODO: ë¸Œë¼ìš°ì € í™˜ê²½ ë¼ìš°í„° ì„¤ì •
    // íŒíŠ¸: ê¸°ì¡´ Router ì‚¬ìš©
  }
};

export const router = createRouter();

// TODO: ë¼ìš°íŠ¸ ì„¤ì •
// íŒíŠ¸:
// 1. router.addRoute("/", HomePage)
// 2. router.addRoute("/product/:id/", ProductDetailPage)  
// 3. router.addRoute("*", NotFoundPage)

// TODO: ì„œë²„ì—ì„œ ì•ˆì „í•˜ê²Œ ë¼ìš°í„° ì‹œì‘
// íŒíŠ¸: typeof window !== "undefined" ì²´í¬ í›„ router.start()
```

**êµ¬í˜„ ì²´í¬í¬ì¸íŠ¸:**
- [ ] ì„œë²„/í´ë¼ì´ì–¸íŠ¸ í™˜ê²½ ë¶„ê¸°
- [ ] MemoryRouter vs Router ì„ íƒ
- [ ] ë¼ìš°íŠ¸ ë“±ë¡
- [ ] ì•ˆì „í•œ ë¸Œë¼ìš°ì € API ì‚¬ìš©

## ğŸ”§ 6ë‹¨ê³„: React SSG êµ¬í˜„

### `static-site-generate.js` êµ¬í˜„
```javascript
import fs from "node:fs/promises";
import path from "node:path";
import { fileURLToPath } from "node:url";

const __dirname = path.dirname(fileURLToPath(import.meta.url));

// í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ SSG ì‹¤í–‰
process.env.NODE_ENV = "production";

const DIST_DIR = path.resolve(__dirname, "../../dist/react");

async function generateStaticSite() {
  try {
    console.log("ğŸš€ React SSG ì‹œì‘...");
    
    // TODO: 1. í…œí”Œë¦¿ HTML ë¡œë“œ
    // íŒíŠ¸: DIST_DIRì˜ index.html ì½ê¸°

    // TODO: 2. ë¹Œë“œëœ React SSR ëª¨ë“ˆ ë¡œë“œ
    // íŒíŠ¸:
    // 1. ./dist/react-ssr/main-server.js import
    // 2. render í•¨ìˆ˜ ì¡´ì¬ í™•ì¸

    if (!render) {
      throw new Error("React render í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");
    }

    // TODO: 3. ìƒì„±í•  í˜ì´ì§€ ëª©ë¡ ì •ì˜
    const pagesToGenerate = await getPages();
    console.log(`ğŸ“„ ${pagesToGenerate.length}ê°œ React í˜ì´ì§€ ìƒì„± ì‹œì‘...`);

    // TODO: 4. ê° í˜ì´ì§€ë³„ë¡œ React ì»´í¬ë„ŒíŠ¸ë¥¼ HTMLë¡œ ë³€í™˜
    for (const page of pagesToGenerate) {
      try {
        console.log(`ğŸ”„ React ì»´í¬ë„ŒíŠ¸ ë Œë”ë§: ${page.url}`);
        
        // TODO: render í•¨ìˆ˜ë¡œ React í˜ì´ì§€ ë Œë”ë§
        // íŒíŠ¸: render(page.url, {}) í˜¸ì¶œ

        // TODO: ì´ˆê¸° ë°ì´í„° ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
        
        // TODO: í…œí”Œë¦¿ì— React ë Œë”ë§ ê²°ê³¼ ì‚½ì…

        // TODO: HTML íŒŒì¼ ì €ì¥
        await saveHtmlFile(page.filePath, html);
        console.log(`âœ… React í˜ì´ì§€ ìƒì„± ì™„ë£Œ: ${page.url}`);
      } catch (error) {
        console.error(`âŒ React í˜ì´ì§€ ${page.url} ìƒì„± ì‹¤íŒ¨:`, error.message);
      }
    }

    console.log(`ğŸ‰ React SSG ì™„ë£Œ!`);
  } catch (error) {
    console.error("ğŸ’¥ React SSG ì‹¤íŒ¨:", error);
    process.exit(1);
  }
}

async function getPages() {
  const pages = [];
  const baseUrl = process.env.NODE_ENV === "production" ? "/front_6th_chapter4-1/react/" : "/";

  // TODO: í™ˆí˜ì´ì§€ ì¶”ê°€
  // íŒíŠ¸: baseUrl, DIST_DIR/index.html

  // TODO: 404 í˜ì´ì§€ ì¶”ê°€
  // íŒíŠ¸: baseUrl + "404", DIST_DIR/404.html

  // TODO: ìƒí’ˆ ìƒì„¸ í˜ì´ì§€ë“¤ ë™ì  ìƒì„±
  try {
    // íŒíŠ¸:
    // 1. ./src/mocks/server.jsì—ì„œ mockGetProducts import
    // 2. ìƒí’ˆ ëª©ë¡ ì¡°íšŒ (limit: 20)
    // 3. ê° ìƒí’ˆë³„ë¡œ pages ë°°ì—´ì— ì¶”ê°€
    // 4. baseUrl + product/${productId}/, DIST_DIR/product/productId/index.html

    console.log(`ğŸ›ï¸ ${productsData.products.length}ê°œ ìƒí’ˆ í˜ì´ì§€ ì¶”ê°€ë¨`);
  } catch (error) {
    console.error("ìƒí’ˆ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:", error);
  }

  return pages;
}

async function saveHtmlFile(filePath, html) {
  // TODO: ë””ë ‰í† ë¦¬ ìƒì„± ë° íŒŒì¼ ì €ì¥
  // íŒíŠ¸: fs.mkdir, fs.writeFile ì‚¬ìš©
}

// ì‹¤í–‰
generateStaticSite().catch(console.error);
```

**êµ¬í˜„ ì²´í¬í¬ì¸íŠ¸:**
- [ ] ë¹Œë“œëœ React SSR ëª¨ë“ˆ ë¡œë“œ
- [ ] React ì»´í¬ë„ŒíŠ¸ ì •ì  ë Œë”ë§
- [ ] ìƒí’ˆë³„ ë™ì  í˜ì´ì§€ ìƒì„±
- [ ] íŒŒì¼ ì‹œìŠ¤í…œ ì¡°ì‘

## ğŸ”§ 7ë‹¨ê³„: TypeScript ë¹Œë“œ ì„¤ì •

### `vite.config.ts` í™•ì¥
```typescript
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";

export default defineConfig({
  plugins: [react()],
  build: {
    rollupOptions: {
      // TODO: SSR ë¹Œë“œ ì‹œ Node.js í™˜ê²½ ìµœì í™”
      // íŒíŠ¸: react-dom/serverë¥¼ externalë¡œ ì„¤ì •
    },
  },
  ssr: {
    // TODO: ì„œë²„ì—ì„œ externalizeí•  íŒ¨í‚¤ì§€ë“¤ ì„¤ì •
    // íŒíŠ¸: @hanghae-plus/libë¥¼ noExternalë¡œ ì„¤ì •
  },
});
```

### `package.json` ìŠ¤í¬ë¦½íŠ¸ ì„¤ì •
```json
{
  "scripts": {
    "dev": "vite",
    "dev:ssr": "node server.js",
    "build:csr": "vite build --outDir ../../dist/react && cp ../../dist/react/index.html ../../dist/react/404.html",
    "build:ssr": "vite build --outDir ./dist/react-ssr --ssr src/main-server.tsx",
    "build:ssg": "node static-site-generate.js",
    "build": "npm run build:csr && npm run build:ssr && npm run build:ssg",
    "preview:ssr": "NODE_ENV=production node server.js",
    "preview:ssg": "NODE_ENV=production vite preview --outDir ../../dist/react",
    "tsc": "tsc --noEmit"
  }
}
```

## ğŸ”§ 8ë‹¨ê³„: React Hook ì„œë²„ ì•ˆì „ì„± í™•ë³´

### ì„œë²„ ì•ˆì „ ì»¤ìŠ¤í…€ Hook êµ¬í˜„
```typescript
// src/hooks/useIsomorphicEffect.ts
import { useEffect, useLayoutEffect } from "react";

// TODO: ì„œë²„/í´ë¼ì´ì–¸íŠ¸ í™˜ê²½ë³„ Effect Hook ì„ íƒ
// íŒíŠ¸: typeof window !== "undefined" ì²´í¬í•˜ì—¬ useLayoutEffect vs useEffect

// src/hooks/useSafeAsync.ts  
import { useEffect, useState } from "react";

export function useSafeAsync<T>(
  asyncFn: () => Promise<T>,
  deps: React.DependencyList
) {
  const [data, setData] = useState<T | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<Error | null>(null);

  useEffect(() => {
    // TODO: ì„œë²„ì—ì„œëŠ” ë¹„ë™ê¸° ì‘ì—… ì‹¤í–‰í•˜ì§€ ì•ŠìŒ
    // íŒíŠ¸:
    // 1. typeof window === "undefined" ì²´í¬
    // 2. ì„œë²„ì—ì„œëŠ” setLoading(false) í›„ return
    // 3. í´ë¼ì´ì–¸íŠ¸ì—ì„œëŠ” asyncFn() ì‹¤í–‰
    // 4. Promise ì™„ë£Œ í›„ ìƒíƒœ ì—…ë°ì´íŠ¸
    // 5. cleanup í•¨ìˆ˜ë¡œ cancelled í”Œë˜ê·¸ ì‚¬ìš©
  }, deps);

  return { data, loading, error };
}
```

**êµ¬í˜„ ì²´í¬í¬ì¸íŠ¸:**
- [ ] ì„œë²„/í´ë¼ì´ì–¸íŠ¸ í™˜ê²½ ë¶„ê¸°
- [ ] ì„œë²„ì—ì„œ ì•ˆì „í•œ Hook ë™ì‘
- [ ] ë¹„ë™ê¸° ì‘ì—… ì·¨ì†Œ ì²˜ë¦¬
- [ ] TypeScript ì œë„¤ë¦­ íƒ€ì… ì§€ì›

## âœ… êµ¬í˜„ ê°€ì´ë“œë¼ì¸

### ğŸ¯ React íŠ¹í™” êµ¬í˜„ í¬ì¸íŠ¸

**1. React SSR ë Œë”ë§**
- `renderToString`ìœ¼ë¡œ React ì»´í¬ë„ŒíŠ¸ë¥¼ HTML ë¬¸ìì—´ ë³€í™˜
- React Router ì„œë²„ í™˜ê²½ ì´ˆê¸°í™”
- React ìƒíƒœê´€ë¦¬ ì„œë²„ ì´ˆê¸°ê°’ ì„¤ì •

**2. React í•˜ì´ë“œë ˆì´ì…˜**
- ì„œë²„ ë Œë”ë§ëœ HTMLê³¼ í´ë¼ì´ì–¸íŠ¸ React ì»´í¬ë„ŒíŠ¸ ë§¤ì¹­
- ì´ˆê¸° ìƒíƒœ ë³µì›ìœ¼ë¡œ í•˜ì´ë“œë ˆì´ì…˜ ì—ëŸ¬ ë°©ì§€
- React 18 createRoot ì‚¬ìš©

**3. ìœ ë‹ˆë²„ì„¤ React ì½”ë“œ**
- ì„œë²„ì—ì„œëŠ” MemoryRouter, í´ë¼ì´ì–¸íŠ¸ì—ì„œëŠ” BrowserRouter
- typeof window ì²´í¬ë¡œ ë¸Œë¼ìš°ì € API ì•ˆì „ ì‚¬ìš©
- React Hook ì„œë²„ ì•ˆì „ì„± í™•ë³´

### ğŸ” React ë””ë²„ê¹… íŒíŠ¸

**í•˜ì´ë“œë ˆì´ì…˜ ë¶ˆì¼ì¹˜:**
- ì„œë²„/í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸° ìƒíƒœ ë™ì¼ì„± í™•ì¸
- ì¡°ê±´ë¶€ ë Œë”ë§ì—ì„œ ì„œë²„/í´ë¼ì´ì–¸íŠ¸ ì°¨ì´ì  í™•ì¸
- React DevToolsì—ì„œ í•˜ì´ë“œë ˆì´ì…˜ ê²½ê³  í™•ì¸

**React Router ë¬¸ì œ:**
- MemoryRouter ì´ˆê¸° URL ì„¤ì • í™•ì¸
- ì„œë²„ì—ì„œ router.push() í˜¸ì¶œ ìˆœì„œ í™•ì¸
- ë¼ìš°íŠ¸ ë§¤ê°œë³€ìˆ˜ ì¶”ì¶œ ë¡œì§ ê²€ì¦

**React ìƒíƒœê´€ë¦¬ ë¬¸ì œ:**
- ì„œë²„ì—ì„œ store ì´ˆê¸°í™” í™•ì¸
- í•˜ì´ë“œë ˆì´ì…˜ ì‹œ ìƒíƒœ ë³µì› ìˆœì„œ í™•ì¸
- Redux/Zustand ì„œë²„ í˜¸í™˜ì„± í™•ì¸

### ğŸ“‹ ë‹¨ê³„ë³„ í…ŒìŠ¤íŠ¸

**React SSR í…ŒìŠ¤íŠ¸:**
```bash
npm run dev:ssr
# React ì»´í¬ë„ŒíŠ¸ê°€ ì„œë²„ì—ì„œ ë Œë”ë§ë˜ëŠ”ì§€ í™•ì¸
# ë¸Œë¼ìš°ì €ì—ì„œ "View Page Source"ë¡œ React HTML í™•ì¸
```

**React í•˜ì´ë“œë ˆì´ì…˜ í…ŒìŠ¤íŠ¸:**
```bash
# DevTools Consoleì—ì„œ í•˜ì´ë“œë ˆì´ì…˜ ì—ëŸ¬ í™•ì¸
# Network íƒ­ì—ì„œ ë¶ˆí•„ìš”í•œ ì¬ìš”ì²­ ì—†ëŠ”ì§€ í™•ì¸
```

**React SSG í…ŒìŠ¤íŠ¸:**
```bash
npm run build
# dist/react ë””ë ‰í† ë¦¬ì˜ ì •ì  HTML íŒŒì¼ í™•ì¸
# ê° HTMLì— React ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ ê²°ê³¼ í¬í•¨ í™•ì¸
```

**í†µí•© í…ŒìŠ¤íŠ¸:**
```bash
npm run preview:ssr
npm run preview:ssg
# SSRê³¼ SSG ê²°ê³¼ë¬¼ ë™ì¼ì„± í™•ì¸
# React ì»´í¬ë„ŒíŠ¸ ìƒí˜¸ì‘ìš© ì •ìƒ ë™ì‘ í™•ì¸
```

## ğŸ¯ React íŠ¹í™” í•™ìŠµ ëª©í‘œ

1. **React SSR ì•„í‚¤í…ì²˜**: `renderToString`ì„ í™œìš©í•œ ì»´í¬ë„ŒíŠ¸ ì„œë²„ ë Œë”ë§
2. **React í•˜ì´ë“œë ˆì´ì…˜**: ì„œë²„ ë Œë”ë§ëœ React ì»´í¬ë„ŒíŠ¸ë¥¼ í´ë¼ì´ì–¸íŠ¸ì—ì„œ í™œì„±í™”
3. **ìœ ë‹ˆë²„ì„¤ React**: ì„œë²„/í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë™ì¼í•˜ê²Œ ì‹¤í–‰ë˜ëŠ” React ì½”ë“œ ì‘ì„±
4. **React Hook ì„œë²„ ì•ˆì „ì„±**: `useEffect`, `useState` ë“±ì´ ì„œë²„ì—ì„œ ì•ˆì „í•˜ê²Œ ë™ì‘í•˜ë„ë¡ ì²˜ë¦¬
5. **React Router SSR**: í´ë¼ì´ì–¸íŠ¸ ë¼ìš°íŒ…ì„ ì„œë²„ì—ì„œë„ ë™ì¼í•˜ê²Œ ì²˜ë¦¬
6. **React ìƒíƒœê´€ë¦¬ SSR**: Redux, Zustand ë“± ìƒíƒœê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ì„œë²„ ì§€ì›
7. **TypeScript SSR**: TypeScript ê¸°ë°˜ React SSR ë¹Œë“œ íŒŒì´í”„ë¼ì¸ êµ¬ì¶•

## ğŸ“š ì°¸ê³ ì‚¬í•­

- React SSR ê°€ì´ë“œ: https://react.dev/reference/react-dom/server
- Vite React SSR: https://vitejs.dev/guide/ssr.html#generating-preload-directives
- React renderToString: https://react.dev/reference/react-dom/server/renderToString
- React Hydration: https://react.dev/reference/react-dom/client/hydrateRoot
