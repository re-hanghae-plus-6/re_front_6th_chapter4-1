# MSW setupServer가 SSR에서 필요한 이유

SSR 환경에서 MSW (Mock Service Worker)의 Node.js 서버가 필요한 이유를 설명합니다.

## 1. 서버 환경의 API 호출 문제

```javascript
// 클라이언트에서는 브라우저가 fetch를 처리
fetch('/api/users') // ✅ 브라우저가 자동으로 현재 도메인으로 요청

// 서버에서는 Node.js 환경
fetch('/api/users') // ❌ 어디로 요청해야 할지 모름
```

## 2. SSR 렌더링 과정에서 API 필요

```javascript
// src/main-server.js에서 렌더링 중
const rendered = await render(url, req.query);
// ↑ 컴포넌트 렌더링 중에 데이터가 필요할 수 있음
```

SSR 과정에서 컴포넌트들이 초기 데이터를 필요로 할 때, 서버 환경에서도 API 호출이 가능해야 합니다.

## 3. MSW Node.js 서버의 역할

```javascript
import { mswServer } from "msw/node";

mswServer.listen({
  onUnhandledRequest: "bypass", // MSW가 처리하지 않는 요청은 통과
});
```

**주요 기능:**
- **요청 가로채기**: 서버 렌더링 중 발생하는 API 호출을 가로챔
- **모킹 또는 프록시**: 실제 API로 전달하거나 목 데이터 제공
- **통합 환경**: 클라이언트와 서버에서 동일한 API 호출 코드 사용 가능

## 4. 실제 시나리오

```javascript
// 컴포넌트에서
useEffect(() => {
  fetch('/api/users').then(setUsers); // 클라이언트에서 실행
}, []);

// SSR 중에도 동일한 데이터가 필요할 때
// MSW가 이 요청을 가로채서 처리
```

## 결론

MSW는 **서버 환경에서도 브라우저와 동일한 방식으로 API 호출**이 가능하도록 해주는 브릿지 역할을 합니다. Node.js에서 `setupServer`를 실행해서 네트워크 요청을 인터셉트하여 SSR과 클라이언트 렌더링에서 일관된 데이터 처리를 가능하게 합니다.